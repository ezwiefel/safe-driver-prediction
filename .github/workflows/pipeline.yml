name: Run / Publish Pipeline

on:
  workflow_call:    
    inputs:
      environment:
        required: true
        description: Environment to run the pipeline in.
        type: string
      submit_pipeline:
        required: false
        type: string
        default: 'true'
      publish_pipeline:
        required: false
        type: string
        default: 'false'
    secrets:
      azure_sp_creds:
        description: Azure Service Principal Credentials
        required: true

jobs:
  pipeline:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    name: Run / Publish Pipeline

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Set up Python Environment
        uses: actions/setup-python@v1
        with:
          python-version: "3.9"
      
      - name: Azure Login
        uses: azure/login@v1
        with:
          creds: ${{secrets.azure_sp_creds}}

      - name: Install Az ML CLI v2
        run: |
          az extension add --name ml

      - name: Set AML Defaults
        run: |
          az configure --defaults group=${{secrets.AML_WORKSPACE}}  workspace=${{secrets.AML_RESOURCE_GROUP}}
      
      - name: List Workspaces
        run: |
          az ml workspace list
